
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SalesFlow Pro - Конструктор Скриптів</title>
    
    <!-- Стилі -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Babel для компіляції JSX в браузері -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Налаштування імпортів (ESM) -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom": "https://esm.sh/react-dom@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1",
    "@google/genai": "https://esm.sh/@google/genai@1.3.0",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>

    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 text-slate-900">
    <div id="root">
        <div class="h-screen w-screen flex items-center justify-center bg-white flex-col gap-4">
            <div class="w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
            <p class="text-gray-500 font-medium">Завантаження інтерфейсу...</p>
        </div>
    </div>

    <!-- Основний скрипт програми -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Search, Moon, Sun, Timer as TimerIcon, Play, Pause, RotateCcw, 
            ChevronRight, Zap, MessageSquare, Download, Star, Type, 
            FileText, Lightbulb, Trash2, Plus, AlertCircle
        } from 'lucide-react';
        import { GoogleGenAI } from "@google/genai";

        // --- ДАНІ ТА КОНСТАНТИ ---
        const INITIAL_SCRIPTS = [
            {
                id: '1',
                title: 'Холодний дзвінок (B2B)',
                category: 'Етап продажу',
                steps: [
                    { id: 's1', label: 'Привітання', content: 'Добрий день! Мене звати [Ім’я], компанія SalesFlow. Я телефоную, щоб запропонувати рішення для вашої команди...', hint: 'Говоріть впевнено, тримайте темп.' },
                    { id: 's2', label: 'Кваліфікація', content: 'Скажіть, скільки менеджерів зараз працює у вашому відділі? Як ви контролюєте скрипти?', hint: 'Ставте відкриті питання.' },
                    { id: 's3', label: 'Закриття', content: 'Пропоную зустрітися на 15 хвилин у вівторок. Об 11:00 буде зручно?', hint: 'Використовуйте техніку вибору без вибору.' }
                ]
            },
            {
                id: '2',
                title: 'Презентація Pro-версії',
                category: 'Продукт',
                steps: [
                    { id: 'p1', label: 'Проблема', content: 'Більшість компаній втрачають до 30% лідів через відсутність швидких підказок...', hint: 'Тисніть на "біль" клієнта.' },
                    { id: 'p2', label: 'Рішення', content: 'Наш інструмент дозволяє бачити скрипт та AI-поради прямо під час розмови.', hint: 'Показуйте вигоду, а не функції.' }
                ]
            }
        ];

        // --- КОМПОНЕНТИ ---

        const Timer = () => {
            const [seconds, setSeconds] = useState(0);
            const [isActive, setIsActive] = useState(false);

            useEffect(() => {
                let interval;
                if (isActive) {
                    interval = setInterval(() => setSeconds(s => s + 1), 1000);
                } else {
                    clearInterval(interval);
                }
                return () => clearInterval(interval);
            }, [isActive]);

            const format = (s) => `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;

            return (
                <div className="flex items-center gap-3 bg-white px-3 py-1.5 rounded-xl border shadow-sm">
                    <span className="font-mono font-bold text-blue-600 flex items-center gap-2">
                        <TimerIcon size={16} /> {format(seconds)}
                    </span>
                    <div className="flex gap-1">
                        <button onClick={() => setIsActive(!isActive)} className="p-1 hover:bg-gray-100 rounded">
                            {isActive ? <Pause size={14} /> : <Play size={14} />}
                        </button>
                        <button onClick={() => {setSeconds(0); setIsActive(false);}} className="p-1 hover:bg-gray-100 rounded">
                            <RotateCcw size={14} />
                        </button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeScript, setActiveScript] = useState(INITIAL_SCRIPTS[0]);
            const [stepIdx, setStepIdx] = useState(0);
            const [notes, setNotes] = useState([]);
            const [noteText, setNoteText] = useState("");
            const [search, setSearch] = useState("");
            const [dark, setDark] = useState(false);
            const [fontSize, setFontSize] = useState(18);
            const [aiHint, setAiHint] = useState(null);
            const [loadingAi, setLoadingAi] = useState(false);

            const filtered = INITIAL_SCRIPTS.filter(s => s.title.toLowerCase().includes(search.toLowerCase()));

            const addNote = (key = false) => {
                if (!noteText.trim()) return;
                setNotes([{ id: Date.now(), content: noteText, isKey: key, time: new Date().toLocaleTimeString() }, ...notes]);
                setNoteText("");
            };

            const getAiAdvice = async () => {
                const key = window.process?.env?.API_KEY;
                if (!key) {
                    setAiHint("API ключ не знайдено.");
                    return;
                }
                setLoadingAi(true);
                try {
                    const ai = new GoogleGenAI({ apiKey: key });
                    const res = await ai.models.generateContent({
                        model: 'gemini-3-flash-preview',
                        contents: `Порада для кроку: ${activeScript.steps[stepIdx].content}. Відповідь клієнта: ${noteText || 'слухає'}. Дай коротку пораду (10 слів).`
                    });
                    setAiHint(res.text);
                } catch (e) { setAiHint("Помилка AI."); }
                setLoadingAi(false);
            };

            return (
                <div className={`h-screen flex flex-col ${dark ? 'bg-slate-950 text-white' : 'bg-gray-50 text-slate-900'} transition-colors duration-300`}>
                    <header className={`h-16 px-6 flex items-center justify-between border-b shrink-0 ${dark ? 'bg-slate-900 border-slate-800' : 'bg-white border-gray-200 shadow-sm'}`}>
                        <div className="flex items-center gap-3">
                            <div className="w-9 h-9 bg-blue-600 rounded-lg flex items-center justify-center text-white font-black">S</div>
                            <span className="font-bold text-lg tracking-tight hidden sm:block">SalesFlow <span className="text-blue-600">Pro</span></span>
                        </div>
                        <div className="flex-1 max-w-md mx-6 relative">
                            <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" size={16} />
                            <input 
                                value={search} onChange={e => setSearch(e.target.value)}
                                placeholder="Шукати скрипт..."
                                className={`w-full pl-10 pr-4 py-2 rounded-xl text-sm outline-none border transition-all ${dark ? 'bg-slate-800 border-slate-700' : 'bg-gray-100 border-transparent focus:bg-white focus:border-blue-400'}`}
                            />
                        </div>
                        <div className="flex items-center gap-3">
                            <Timer />
                            <button onClick={() => setDark(!dark)} className="p-2 hover:bg-gray-100 rounded-full">
                                {dark ? <Sun size={20} /> : <Moon size={20} className="text-gray-500" />}
                            </button>
                        </div>
                    </header>

                    <div className="flex-1 flex overflow-hidden">
                        <aside className={`w-64 border-r p-4 hidden md:flex flex-col shrink-0 ${dark ? 'bg-slate-900 border-slate-800' : 'bg-white border-gray-200'}`}>
                            <h3 className="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-4 px-2">Каталог</h3>
                            <div className="space-y-1">
                                {filtered.map(s => (
                                    <button 
                                        key={s.id} onClick={() => {setActiveScript(s); setStepIdx(0); setAiHint(null);}}
                                        className={`w-full text-left p-2.5 rounded-lg text-sm font-medium transition-all ${activeScript.id === s.id ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-100'}`}
                                    >
                                        {s.title}
                                    </button>
                                ))}
                            </div>
                        </aside>

                        <main className="flex-1 flex flex-col overflow-hidden relative">
                            <div className={`px-8 py-4 border-b flex items-center justify-between ${dark ? 'bg-slate-800 border-slate-700' : 'bg-white'}`}>
                                <div>
                                    <span className="text-[10px] font-bold text-blue-500 uppercase">{activeScript.category}</span>
                                    <h2 className="text-xl font-bold">{activeScript.title}</h2>
                                </div>
                                <div className="flex items-center gap-2 bg-gray-100 p-1 rounded-lg">
                                    <button onClick={() => setFontSize(f => Math.max(12, f-2))} className="p-1 hover:bg-white rounded"><Type size={14} /></button>
                                    <span className="text-xs font-mono font-bold w-8 text-center">{fontSize}</span>
                                    <button onClick={() => setFontSize(f => Math.min(32, f+2))} className="p-1 hover:bg-white rounded"><Type size={14} /></button>
                                </div>
                            </div>

                            <div className="flex-1 overflow-y-auto p-8 custom-scrollbar bg-transparent">
                                <div className="max-w-3xl mx-auto space-y-6">
                                    <div className="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
                                        {activeScript.steps.map((s, i) => (
                                            <button 
                                                key={s.id} onClick={() => {setStepIdx(i); setAiHint(null);}}
                                                className={`px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all ${stepIdx === i ? 'bg-blue-600 text-white shadow-sm' : 'bg-gray-200 text-gray-500'}`}
                                            >
                                                {i+1}. {s.label}
                                            </button>
                                        ))}
                                    </div>

                                    <div 
                                        className={`p-10 rounded-3xl border shadow-sm leading-relaxed animate-fade-in ${dark ? 'bg-slate-900 border-slate-800' : 'bg-white border-gray-100'}`}
                                        style={{ fontSize: `${fontSize}px` }}
                                    >
                                        {activeScript.steps[stepIdx].content}
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="p-4 bg-amber-50 border-l-4 border-amber-400 rounded-r-xl flex gap-3">
                                            <Lightbulb className="text-amber-500 shrink-0" size={20} />
                                            <div>
                                                <p className="text-[10px] font-black text-amber-600 uppercase mb-1">Методична підказка</p>
                                                <p className="text-sm text-amber-900 font-medium">{activeScript.steps[stepIdx].hint}</p>
                                            </div>
                                        </div>
                                        {aiHint && (
                                            <div className="p-4 bg-blue-50 border-l-4 border-blue-400 rounded-r-xl flex gap-3 animate-fade-in">
                                                <Zap className="text-blue-500 shrink-0 fill-blue-500" size={20} />
                                                <div>
                                                    <p className="text-[10px] font-black text-blue-600 uppercase mb-1">AI Адаптація</p>
                                                    <p className="text-sm text-blue-900 font-medium">{aiHint}</p>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>

                            <div className="p-6 border-t bg-gray-50 flex justify-between items-center shrink-0">
                                <div className="flex gap-2">
                                    <button disabled={stepIdx === 0} onClick={() => setStepIdx(i => i-1)} className="px-6 py-2.5 rounded-xl font-bold border-2 disabled:opacity-20 hover:bg-gray-100 transition-all">Назад</button>
                                    <button disabled={stepIdx === activeScript.steps.length-1} onClick={() => setStepIdx(i => i+1)} className="px-6 py-2.5 bg-slate-900 text-white rounded-xl font-bold disabled:opacity-20 hover:bg-slate-800 transition-all">Наступний крок</button>
                                </div>
                                <button onClick={getAiAdvice} disabled={loadingAi} className="px-6 py-2.5 bg-blue-600 text-white rounded-xl font-bold flex items-center gap-2 shadow-lg shadow-blue-200 hover:bg-blue-700 disabled:bg-blue-400 transition-all">
                                    <Zap size={18} className={loadingAi ? 'animate-pulse' : ''} />
                                    {loadingAi ? 'Аналіз...' : 'Адаптувати (AI)'}
                                </button>
                            </div>
                        </main>

                        <aside className={`w-80 border-l flex flex-col shrink-0 ${dark ? 'bg-slate-900 border-slate-800' : 'bg-white border-gray-200'}`}>
                            <div className="p-4 border-b flex items-center justify-between">
                                <h3 className="font-bold text-sm flex items-center gap-2"><MessageSquare size={16} /> Нотатки</h3>
                                <button className="p-1.5 hover:bg-gray-100 rounded text-gray-400"><Download size={16} /></button>
                            </div>
                            <div className="p-4 space-y-3">
                                <textarea 
                                    value={noteText} onChange={e => setNoteText(e.target.value)}
                                    placeholder="Введіть зауваження клієнта..."
                                    className={`w-full p-3 rounded-xl border text-sm h-28 resize-none outline-none focus:ring-2 focus:ring-blue-500 transition-all ${dark ? 'bg-slate-800 border-slate-700' : 'bg-gray-50'}`}
                                />
                                <div className="flex gap-2">
                                    <button onClick={() => addNote(false)} className="flex-1 py-2 bg-slate-100 rounded-lg text-sm font-bold hover:bg-slate-200 transition-all">Зберегти</button>
                                    <button onClick={() => addNote(true)} className="px-3 py-2 bg-amber-100 text-amber-600 rounded-lg hover:bg-amber-200 transition-all"><Star size={16} /></button>
                                </div>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar">
                                {notes.map(n => (
                                    <div key={n.id} className={`p-3 rounded-xl border text-sm animate-fade-in relative group ${n.isKey ? 'bg-amber-50 border-amber-200' : 'bg-gray-50 border-gray-100'}`}>
                                        <div className="text-[9px] font-bold text-gray-400 mb-1">{n.time}</div>
                                        <p className="pr-4">{n.content}</p>
                                        <button onClick={() => setNotes(notes.filter(x => x.id !== n.id))} className="absolute top-2 right-2 text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all">
                                            <Trash2 size={12} />
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </aside>
                    </div>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
